{"ast":null,"code":"import _slicedToArray from\"/home/cristian/Documentos/ProyectosGIT/exposicionVirtualFrontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{useEffect,useState,useContext}from\"react\";import'../../client/css/index.css';import $ from'jquery';import{useHistory}from\"react-router-dom\";import M from'materialize-css';// import MercadoPagoProducto from '../../components/MercadoPagoProducto';\nimport ShopContext from'../../components/context/shop-context';import{precioTotal,sendMethodCostTopLevel,sendMethodNameTopLevel}from'../../components/ShoppingCart';// document.addEventListener('DOMContentLoaded', function() {\n//   var elems = document.querySelectorAll('.autocomplete');\n//   M.Autocomplete.init(elems, {});\n// });\nvar TestForm=function TestForm(){var history=useHistory();//    //REPLACE WITH YOUR PUBLIC KEY AVAILABLE IN: https://developers.mercadopago.com/panel/credentials\nwindow.Mercadopago.setPublishableKey(\"TEST-5429f1b7-5db8-46fd-bf95-26ae8fcd39fe\");// window.Mercadopago.getIdentificationTypes();\nvar context=useContext(ShopContext);var _useState=useState(1),_useState2=_slicedToArray(_useState,2),quantity=_useState2[0],setQuantity=_useState2[1];var _useState3=useState(10),_useState4=_slicedToArray(_useState3,1),unitPrice=_useState4[0];var _useState5=useState(precioTotal(context.cart)+sendMethodCostTopLevel),_useState6=_slicedToArray(_useState5,1),amount=_useState6[0];var _useState7=useState(\"Some book\"),_useState8=_slicedToArray(_useState7,1),description=_useState8[0];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),cardNumber=_useState10[0],setCardNumber=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),paymentmethod=_useState12[0],setpaymentmethod=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),paymentmethodId=_useState14[0],setpaymentmethodId=_useState14[1];var installments=null;var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),paymentmethodThumbnail=_useState16[0],setpaymentmethodThumbnail=_useState16[1];var _useState17=useState({backgroundImage:null}),_useState18=_slicedToArray(_useState17,2),paymentmethodThumbnailStyle=_useState18[0],setpaymentmethodThumbnailStyle=_useState18[1];var _useState19=useState(\"$ 10\"),_useState20=_slicedToArray(_useState19,2),cartTotal=_useState20[0],setCartTotal=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),email=_useState22[0],setEmail=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),docTypes=_useState24[0],setDocTypes=_useState24[1];// const [token, setToken] = useState(null);\n// const [docTypes, setDocTypes] = useState(null);\n// useEffect(() => {\n//   if(!docTypes){\n//     fetch(\"https://api.mercadopago.com/v1/identification_types?public_key=TEST-147fd98d-a235-429b-aa09-a5b157a1fe61\", {\n//       headers: {\n//         \"Content-type\": \"application/json\",\n//       }\n//       }).then((res) => {\n//         console.log(res)\n//         if (res.ok) {\n//           return res.json()\n//         }\n//       }).then((response)=>{\n//         var hola = document.createElement(\"option\")\n//       hola.text = \"hola\"\n//       document.getElementById(\"docType\").add(hola)\n//       var hola = document.createElement(\"option\")\n//       hola.text = \"hola1\"\n//       // document.getElementById(\"docType\").add(hola)\n//         // console.log(\"gggfgfgfg\"+response)\n//         setDocTypes(response)\n//         console.log(docTypes)\n//       }, [docTypes])\n//   }\n// })\nfunction guessPaymentMethod(event){cleanCardInfo();setCardNumber(event.target.value);console.log(event.target.value);if(event.target.value.length>=6){var bin=event.target.value.substring(0,6);window.Mercadopago.getPaymentMethod({\"bin\":bin},setPaymentMethod);}};function setPaymentMethod(status,response){if(status===200){console.log(paymentmethodThumbnailStyle);setpaymentmethod(response[0]);setpaymentmethodId(response[0].id);setpaymentmethodThumbnail('url('+response[0].thumbnail+')');setpaymentmethodThumbnailStyle({backgroundImage:'url('+response[0].thumbnail+')'});console.log(paymentmethodThumbnailStyle);if(response[0].additional_info_needed.includes(\"issuer_id\")){getIssuers(response[0].id);}else{document.getElementById('issuerInput').classList.add(\"hidden\");getInstallments(response[0].id,document.getElementById('amount').value);}}}function getIssuers(paymentMethodId){window.Mercadopago.getIssuers(paymentMethodId,setIssuers);}function setIssuers(status,response){if(status===200){var issuerSelect=document.getElementById('issuer');response.forEach(function(issuer){var opt=document.createElement('option');opt.text=issuer.name;opt.value=issuer.id;issuerSelect.appendChild(opt);});if(issuerSelect.options.length<=1){document.getElementById('issuerInput').classList.add(\"hidden\");}else{document.getElementById('issuerInput').classList.remove(\"hidden\");}getInstallments(document.getElementById('paymentMethodId').value,document.getElementById('amount').value,issuerSelect.value);}else{alert(\"issuers method info error: \".concat(response));}}function getInstallments(paymentMethodId,amount,issuerId){window.Mercadopago.getInstallments({\"payment_method_id\":paymentMethodId,\"amount\":parseFloat(amount),\"issuer_id\":issuerId?parseInt(issuerId):undefined},setInstallments);}function setInstallments(status,response){if(status===200){document.getElementById('installments').options.length=0;response[0].payer_costs.forEach(function(payerCost){var opt=document.createElement('option');opt.text=payerCost.recommended_message;opt.value=payerCost.installments;document.getElementById('installments').appendChild(opt);});}else{// alert(`installments method info error: ${response}`);\n}}// //Update offered installments when issuer changes\nfunction updateInstallmentsForIssuer(event){window.Mercadopago.getInstallments({\"payment_method_id\":document.getElementById('paymentMethodId').value,\"amount\":parseFloat(document.getElementById('amount').value),\"issuer_id\":parseInt(document.getElementById('issuer').value)},setInstallments);}// //Proceed with payment\nvar doSubmit=false;function getCardToken(event){event.preventDefault();if(!doSubmit){var $form=document.getElementById('paymentForm');window.Mercadopago.createToken($form,setCardTokenAndPay);return false;}};var updatePaymentMethodThumbnail={backgroundImage:paymentmethodThumbnail};function setCardTokenAndPay(status,response){if(status===200||status===201){// let form = document.getElementById('paymentForm');\n// let card = document.createElement('input');\n// card.setAttribute('name', 'token');\n// card.setAttribute('type', 'hidden');\n// card.setAttribute('value', response.id);\n// setToken(response.id)\n// form.appendChild(card);\ndoSubmit=true;// form.submit(); //Submit form data to your backend\npostearPago(response.id);}else{alert(\"Verify filled data!\\n\"+JSON.stringify(response,null,4));}};/***\n   * UX functions \n   */function cleanCardInfo(){setpaymentmethodThumbnailStyle({backgroundImage:\"\"});document.getElementById('issuerInput').classList.add(\"hidden\");document.getElementById('issuer').options.length=0;document.getElementById('installments').options.length=0;}// //Handle transitions\nfunction checkoutShoppingCart(){$('.shopping-cart').fadeOut(500);setTimeout(function(){$('.container_payment').show(500).fadeIn();},500);}function goBackContainerPayment(){$('.container_payment').fadeOut(500);setTimeout(function(){$('.shopping-cart').show(500).fadeIn();},500);}var postearPago=function postearPago(tokenString){if(cartTotal&&unitPrice&&email&&description&&amount&&quantity){//cartTotal && unitPrice && email && description && amount && quantity && token){\nfetch(\"https://exposicion-virtual.herokuapp.com/process_payment\",{method:\"POST\",headers:{\"Content-type\":\"application/json\",\"Authorization\":localStorage.getItem(\"tokenValido\")},body:JSON.stringify({\"token\":tokenString,\"unitPrice\":unitPrice,\"email\":email,\"description\":description,\"amount\":precioTotal(context.cart)+sendMethodCostTopLevel,\"quantity\":quantity,\"paymentMethodId\":paymentmethodId,\"installments\":document.getElementById(\"installments\").value,\"issuerId\":document.getElementById(\"issuer\").value,\"docType\":document.getElementById(\"docType\").value,\"docNumber\":document.getElementById(\"docNumber\").value})}).then(function(res){console.log(res);if(res.ok){return res.json();}else{M.toast({html:\"Error inesperado\",classes:\"#c62828 red darken-3\"});window.Mercadopago.clearSession();}}).then(function(data){if(data&&(data.status_detail===\"accredited\"||data.status_detail===\"pending_contingency\"||data.status_detail===\"pending_review_manual\")){console.log(data.comunicacion_sugerida);console.log(\"realizandoPAGO\");M.toast({html:data.comunicacion_sugerida,classes:\"#388e3c green darken-2\"});actualizarBaseDeDatos();vacioCarrito();}else{M.toast({html:data.comunicacion_sugerida,classes:\"#c62828 red darken-3\"});}history.push(\"/\");window.Mercadopago.clearSession();}).catch(function(err){console.log(err);window.Mercadopago.clearSession();});}else{M.toast({html:\"Llenar todos los campos\",classes:\"#c62828 red darken-3\"});}};var actualizarBaseDeDatos=function actualizarBaseDeDatos(){fetch(\"https://exposicion-virtual.herokuapp.com/productSales\",{method:\"PUT\",headers:{\"Content-type\":\"application/json\",\"Authorization\":localStorage.getItem(\"tokenValido\")},body:JSON.stringify({\"sales\":listaProductosEnPares()})}).then(function(res){console.log(res);}).catch(function(error){console.log(error);});};var listaProductosEnPares=function listaProductosEnPares(){var arrayResultado=[];context.cart.forEach(function(product){console.log(\"Pase por (\"+product.id+\", \"+product.quantity+\")\");arrayResultado.push({\"idProducto\":product.id,\"cantidadVendida\":product.quantity});});console.log(arrayResultado);return arrayResultado;};var vacioCarrito=function vacioCarrito(){context.cart.forEach(function(product){context.deleteProductFromCart(product.id);});};var selectDocTypes=function selectDocTypes(){if(docTypes.length===0){fetch(\"https://api.mercadopago.com/v1/identification_types?public_key=TEST-147fd98d-a235-429b-aa09-a5b157a1fe61\",{headers:{\"Content-type\":\"application/json\"}}).then(function(res){if(res.ok){return res.json();}}).then(function(response){setDocTypes(response);});}return/*#__PURE__*/React.createElement(\"select\",{id:\"docType\",name:\"docType\",\"data-checkout\":\"docType\",class:\"form-control select-visible\"},docTypes.map(function(opt){return/*#__PURE__*/React.createElement(\"option\",{value:opt.id},opt.name);}));};return/*#__PURE__*/React.createElement(\"div\",null,checkoutShoppingCart(),/*#__PURE__*/React.createElement(\"section\",{class:\"payment-form dark\"},/*#__PURE__*/React.createElement(\"div\",{class:\"container_payment\"},/*#__PURE__*/React.createElement(\"div\",{class:\"block-heading\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Pago con tarjeta\")),/*#__PURE__*/React.createElement(\"div\",{class:\"form-payment\"},/*#__PURE__*/React.createElement(\"div\",{class:\"products\"},/*#__PURE__*/React.createElement(\"h2\",{class:\"title\"},\"Resumen\"),/*#__PURE__*/React.createElement(\"div\",{class:\"item\"},/*#__PURE__*/React.createElement(\"span\",{class:\"price\",id:\"summary-price\",value:'$ '+unitPrice}),context.cart.map(function(product){return/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col s6\"},/*#__PURE__*/React.createElement(\"p\",{class:\"item-name\"},product.itemName,\" \",/*#__PURE__*/React.createElement(\"span\",{id:\"summary-quantity\",value:quantity},\"x \",product.quantity))),/*#__PURE__*/React.createElement(\"div\",{className:\"col s6\"},/*#__PURE__*/React.createElement(\"p\",{class:\"item-name item-total-price\"},\"$ \",product.itemPrice*product.quantity)));}),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col s6\"},/*#__PURE__*/React.createElement(\"p\",{class:\"item-name\"},sendMethodNameTopLevel,\" \",/*#__PURE__*/React.createElement(\"span\",{id:\"summary-quantity\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col s6\"},/*#__PURE__*/React.createElement(\"p\",{class:\"item-name item-total-price\"},\"$ \",sendMethodCostTopLevel)))),/*#__PURE__*/React.createElement(\"div\",{class:\"total\"},\"Total\",/*#__PURE__*/React.createElement(\"span\",{class:\"price\",id:\"summary-total\"},\"$ \",precioTotal(context.cart)+sendMethodCostTopLevel))),/*#__PURE__*/React.createElement(\"div\",{class:\"payment-details\"},/*#__PURE__*/React.createElement(\"form\",{action:\"#\",id:\"paymentForm\"},/*#__PURE__*/React.createElement(\"h3\",{class:\"title\"},\"Datos del comprador\"),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-5\"},/*#__PURE__*/React.createElement(\"label\",{for:\"email\"},\"E-Mail\"),/*#__PURE__*/React.createElement(\"input\",{id:\"email\",name:\"email\",type:\"text\",class:\"form-control\",onChange:function onChange(e){return setEmail(e.target.value);}}))),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-5\"},/*#__PURE__*/React.createElement(\"label\",{for:\"docType\"},\"Tipo de documento\"),selectDocTypes()),/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-7\"},/*#__PURE__*/React.createElement(\"label\",{for:\"docNumber\"},\"Numero de documento\"),/*#__PURE__*/React.createElement(\"input\",{id:\"docNumber\",name:\"docNumber\",\"data-checkout\":\"docNumber\",type:\"text\",class:\"form-control\"}))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h3\",{class:\"title\"},\"Datos de la tarjeta\"),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-8\"},/*#__PURE__*/React.createElement(\"label\",{for:\"cardholderName\"},\"Titular de la tarjeta\"),/*#__PURE__*/React.createElement(\"input\",{id:\"cardholderName\",\"data-checkout\":\"cardholderName\",type:\"text\",class:\"form-control\"})),/*#__PURE__*/React.createElement(\"div\",{class:\"col s12\"},/*#__PURE__*/React.createElement(\"label\",{for:\"\"},\"Fecha de vencimiento\"),/*#__PURE__*/React.createElement(\"div\",{class:\"input-group expiration-date\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",class:\"form-control\",placeholder:\"MM\",id:\"cardExpirationMonth\",\"data-checkout\":\"cardExpirationMonth\",onselectstart:\"return false\",onpaste:\"return false\",onCopy:\"return false\",onCut:\"return false\",onDrag:\"return false\",onDrop:\"return false\",autocomplete:\"off\"}),/*#__PURE__*/React.createElement(\"span\",{class:\"date-separator\"},\"/\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",class:\"form-control\",placeholder:\"YY\",id:\"cardExpirationYear\",\"data-checkout\":\"cardExpirationYear\",onselectstart:\"return false\",onpaste:\"return false\",onCopy:\"return false\",onCut:\"return false\",onDrag:\"return false\",onDrop:\"return false\",autocomplete:\"off\"}))),/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-8\"},/*#__PURE__*/React.createElement(\"label\",{for:\"cardNumber\"},\"N\\xFAmero de tarjeta\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",class:\"form-control input-background\",id:\"cardNumber\",\"data-checkout\":\"cardNumber\",onselectstart:\"return false\",onpaste:\"return false\",onCopy:\"return false\",onCut:\"return false\",onDrag:\"return false\",onDrop:\"return false\",style:paymentmethodThumbnailStyle,autocomplete:\"off\",onChange:guessPaymentMethod})),/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-4\"},/*#__PURE__*/React.createElement(\"label\",{for:\"securityCode\"},\"C\\xF3digo de seguridad\"),/*#__PURE__*/React.createElement(\"input\",{id:\"securityCode\",\"data-checkout\":\"securityCode\",type:\"text\",class:\"form-control\",onselectstart:\"return false\",onpaste:\"return false\",onCopy:\"return false\",onCut:\"return false\",onDrag:\"return false\",onDrop:\"return false\",autocomplete:\"off\"})),/*#__PURE__*/React.createElement(\"div\",{id:\"issuerInput\",class:\"form-group col-sm-12 hidden\"},/*#__PURE__*/React.createElement(\"label\",{for:\"issuer\"},\"Entidad emisora\"),/*#__PURE__*/React.createElement(\"select\",{id:\"issuer\",name:\"issuer\",\"data-checkout\":\"issuer\",class:\"form-control select-visible\",onChange:updateInstallmentsForIssuer})),/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-12\"},/*#__PURE__*/React.createElement(\"label\",{for:\"installments\"},\"Cuotas\"),/*#__PURE__*/React.createElement(\"select\",{type:\"text\",id:\"installments\",name:\"installments\",class:\"form-control select-visible\"})),/*#__PURE__*/React.createElement(\"div\",{class:\"form-group col-sm-12\"},/*#__PURE__*/React.createElement(\"input\",{type:\"hidden\",name:\"transactionAmount\",id:\"amount\",value:amount}),/*#__PURE__*/React.createElement(\"input\",{type:\"hidden\",name:\"paymentMethodId\",id:\"paymentMethodId\",value:paymentmethodId}),/*#__PURE__*/React.createElement(\"input\",{type:\"hidden\",name:\"description\",id:\"description\",value:description}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col s12\"},/*#__PURE__*/React.createElement(\"a\",{onClick:getCardToken,className:\"waves-effect waves-light red lighten-2 btn-large\",id:\"butonSubmit\"},\"Pagar\"))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"a\",{id:\"go-back\",href:\"/shoppingcart\"},/*#__PURE__*/React.createElement(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"12\",height:\"12\",viewBox:\"0 0 10 10\",class:\"chevron-left\"},/*#__PURE__*/React.createElement(\"path\",{fill:\"#009EE3\",\"fill-rule\":\"nonzero\",id:\"chevron_left\",d:\"M7.05 1.4L6.2.552 1.756 4.997l4.449 4.448.849-.848-3.6-3.6z\"})),\"Volver al carrito\")))))))));};export default TestForm;","map":{"version":3,"sources":["/home/cristian/Documentos/ProyectosGIT/exposicionVirtualFrontend/src/components/AdminPanel/index.js"],"names":["React","useEffect","useState","useContext","$","useHistory","M","ShopContext","precioTotal","sendMethodCostTopLevel","sendMethodNameTopLevel","TestForm","history","window","Mercadopago","setPublishableKey","context","quantity","setQuantity","unitPrice","cart","amount","description","cardNumber","setCardNumber","paymentmethod","setpaymentmethod","paymentmethodId","setpaymentmethodId","installments","paymentmethodThumbnail","setpaymentmethodThumbnail","backgroundImage","paymentmethodThumbnailStyle","setpaymentmethodThumbnailStyle","cartTotal","setCartTotal","email","setEmail","docTypes","setDocTypes","guessPaymentMethod","event","cleanCardInfo","target","value","console","log","length","bin","substring","getPaymentMethod","setPaymentMethod","status","response","id","thumbnail","additional_info_needed","includes","getIssuers","document","getElementById","classList","add","getInstallments","paymentMethodId","setIssuers","issuerSelect","forEach","issuer","opt","createElement","text","name","appendChild","options","remove","alert","issuerId","parseFloat","parseInt","undefined","setInstallments","payer_costs","payerCost","recommended_message","updateInstallmentsForIssuer","doSubmit","getCardToken","preventDefault","$form","createToken","setCardTokenAndPay","updatePaymentMethodThumbnail","postearPago","JSON","stringify","checkoutShoppingCart","fadeOut","setTimeout","show","fadeIn","goBackContainerPayment","tokenString","fetch","method","headers","localStorage","getItem","body","then","res","ok","json","toast","html","classes","clearSession","data","status_detail","comunicacion_sugerida","actualizarBaseDeDatos","vacioCarrito","push","catch","err","listaProductosEnPares","error","arrayResultado","product","deleteProductFromCart","selectDocTypes","map","itemName","itemPrice","e"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useEffect, useState, useContext } from \"react\";\nimport '../../client/css/index.css';\nimport $ from 'jquery'\nimport { useHistory } from \"react-router-dom\";\nimport M from 'materialize-css'\n// import MercadoPagoProducto from '../../components/MercadoPagoProducto';\nimport ShopContext from '../../components/context/shop-context'\nimport { precioTotal, sendMethodCostTopLevel, sendMethodNameTopLevel } from '../../components/ShoppingCart'\n\n// document.addEventListener('DOMContentLoaded', function() {\n//   var elems = document.querySelectorAll('.autocomplete');\n//   M.Autocomplete.init(elems, {});\n// });\n\nconst TestForm = () => {\n  const history = useHistory();\n  //    //REPLACE WITH YOUR PUBLIC KEY AVAILABLE IN: https://developers.mercadopago.com/panel/credentials\n  window.Mercadopago.setPublishableKey(\"TEST-5429f1b7-5db8-46fd-bf95-26ae8fcd39fe\");\n  // window.Mercadopago.getIdentificationTypes();\n  const context = useContext(ShopContext);\n  const [quantity, setQuantity] = useState(1);\n  const [unitPrice] = useState(10);\n  const [amount] = useState(precioTotal(context.cart) + sendMethodCostTopLevel);\n  const [description] = useState(\"Some book\");\n  const [cardNumber, setCardNumber] = useState(\"\");\n  const [paymentmethod, setpaymentmethod] = useState(null);\n  const [paymentmethodId, setpaymentmethodId] = useState(null);\n  let installments = null;\n  const [paymentmethodThumbnail, setpaymentmethodThumbnail] = useState(\"\");\n  const [paymentmethodThumbnailStyle, setpaymentmethodThumbnailStyle] = useState({ backgroundImage: null, });\n  const [cartTotal, setCartTotal] = useState(\"$ 10\");\n  const [email, setEmail] = useState(\"\");\n  const [docTypes, setDocTypes] = useState([])\n\n  // const [token, setToken] = useState(null);\n  // const [docTypes, setDocTypes] = useState(null);\n\n  // useEffect(() => {\n  //   if(!docTypes){\n  //     fetch(\"https://api.mercadopago.com/v1/identification_types?public_key=TEST-147fd98d-a235-429b-aa09-a5b157a1fe61\", {\n  //       headers: {\n  //         \"Content-type\": \"application/json\",\n  //       }\n  //       }).then((res) => {\n  //         console.log(res)\n  //         if (res.ok) {\n  //           return res.json()\n  //         }\n  //       }).then((response)=>{\n  //         var hola = document.createElement(\"option\")\n  //       hola.text = \"hola\"\n  //       document.getElementById(\"docType\").add(hola)\n  //       var hola = document.createElement(\"option\")\n  //       hola.text = \"hola1\"\n  //       // document.getElementById(\"docType\").add(hola)\n  //         // console.log(\"gggfgfgfg\"+response)\n  //         setDocTypes(response)\n  //         console.log(docTypes)\n  //       }, [docTypes])\n  //   }\n  // })\n\n  function guessPaymentMethod(event) {\n    cleanCardInfo();\n    setCardNumber(event.target.value);\n\n    console.log(event.target.value)\n    if (event.target.value.length >= 6) {\n      let bin = event.target.value.substring(0, 6);\n\n      window.Mercadopago.getPaymentMethod({\n        \"bin\": bin\n      }, setPaymentMethod);\n    }\n  };\n\n  function setPaymentMethod(status, response) {\n    if (status === 200) {\n      console.log(paymentmethodThumbnailStyle)\n      setpaymentmethod(response[0]);\n      setpaymentmethodId(response[0].id);\n      setpaymentmethodThumbnail('url(' + response[0].thumbnail + ')');\n      setpaymentmethodThumbnailStyle({ backgroundImage: 'url(' + response[0].thumbnail + ')', });\n      console.log(paymentmethodThumbnailStyle)\n      if (response[0].additional_info_needed.includes(\"issuer_id\")) {\n        getIssuers(response[0].id);\n      } else {\n        document.getElementById('issuerInput').classList.add(\"hidden\");\n\n        getInstallments(\n          response[0].id,\n          document.getElementById('amount').value\n        );\n      }\n    }\n  }\n\n  function getIssuers(paymentMethodId) {\n    window.Mercadopago.getIssuers(\n      paymentMethodId,\n      setIssuers\n    );\n  }\n\n  function setIssuers(status, response) {\n    if (status === 200) {\n      let issuerSelect = document.getElementById('issuer');\n      response.forEach(issuer => {\n        let opt = document.createElement('option');\n        opt.text = issuer.name;\n        opt.value = issuer.id;\n        issuerSelect.appendChild(opt);\n      });\n\n      if (issuerSelect.options.length <= 1) {\n        document.getElementById('issuerInput').classList.add(\"hidden\");\n      } else {\n        document.getElementById('issuerInput').classList.remove(\"hidden\");\n      }\n\n      getInstallments(\n        document.getElementById('paymentMethodId').value,\n        document.getElementById('amount').value,\n        issuerSelect.value\n      );\n\n    } else {\n      alert(`issuers method info error: ${response}`);\n    }\n  }\n\n  function getInstallments(paymentMethodId, amount, issuerId) {\n    window.Mercadopago.getInstallments({\n      \"payment_method_id\": paymentMethodId,\n      \"amount\": parseFloat(amount),\n      \"issuer_id\": issuerId ? parseInt(issuerId) : undefined\n    }, setInstallments);\n  }\n\n  function setInstallments(status, response) {\n    if (status === 200) {\n      document.getElementById('installments').options.length = 0;\n      response[0].payer_costs.forEach(payerCost => {\n        let opt = document.createElement('option');\n        opt.text = payerCost.recommended_message;\n        opt.value = payerCost.installments;\n        document.getElementById('installments').appendChild(opt);\n      });\n    } else {\n      // alert(`installments method info error: ${response}`);\n    }\n  }\n\n  // //Update offered installments when issuer changes\n  function updateInstallmentsForIssuer(event) {\n    window.Mercadopago.getInstallments({\n      \"payment_method_id\": document.getElementById('paymentMethodId').value,\n      \"amount\": parseFloat(document.getElementById('amount').value),\n      \"issuer_id\": parseInt(document.getElementById('issuer').value)\n    }, setInstallments);\n  }\n\n  // //Proceed with payment\n  var doSubmit = false;\n  function getCardToken(event) {\n    event.preventDefault();\n    if (!doSubmit) {\n      let $form = document.getElementById('paymentForm');\n      window.Mercadopago.createToken($form, setCardTokenAndPay);\n      return false;\n    }\n  };\n\n  const updatePaymentMethodThumbnail = {\n    backgroundImage: paymentmethodThumbnail,\n  };\n\n  function setCardTokenAndPay(status, response) {\n    if (status === 200 || status === 201) {\n      // let form = document.getElementById('paymentForm');\n      // let card = document.createElement('input');\n      // card.setAttribute('name', 'token');\n      // card.setAttribute('type', 'hidden');\n      // card.setAttribute('value', response.id);\n      // setToken(response.id)\n      // form.appendChild(card);\n      doSubmit = true;\n      // form.submit(); //Submit form data to your backend\n      postearPago(response.id)\n    } else {\n      alert(\"Verify filled data!\\n\" + JSON.stringify(response, null, 4));\n    }\n  };\n  /***\n   * UX functions \n   */\n\n  function cleanCardInfo() {\n    setpaymentmethodThumbnailStyle({ backgroundImage: \"\", })\n    document.getElementById('issuerInput').classList.add(\"hidden\");\n    document.getElementById('issuer').options.length = 0;\n    document.getElementById('installments').options.length = 0;\n  }\n\n  // //Handle transitions\n  function checkoutShoppingCart() {\n    $('.shopping-cart').fadeOut(500);\n    setTimeout(() => { $('.container_payment').show(500).fadeIn(); }, 500);\n  }\n\n  function goBackContainerPayment() {\n    $('.container_payment').fadeOut(500);\n    setTimeout(() => { $('.shopping-cart').show(500).fadeIn(); }, 500);\n  }\n\n  const postearPago = (tokenString) => {\n    if (cartTotal && unitPrice && email && description && amount && quantity) {//cartTotal && unitPrice && email && description && amount && quantity && token){\n      fetch(\"https://exposicion-virtual.herokuapp.com/process_payment\", {\n        method: \"POST\",\n        headers: {\n          \"Content-type\": \"application/json\",\n          \"Authorization\": localStorage.getItem(\"tokenValido\")\n        },\n        body: JSON.stringify({\n          \"token\": tokenString,\n          \"unitPrice\": unitPrice,\n          \"email\": email,\n          \"description\": description,\n          \"amount\": precioTotal(context.cart) + sendMethodCostTopLevel,\n          \"quantity\": quantity,\n          \"paymentMethodId\": paymentmethodId,\n          \"installments\": document.getElementById(\"installments\").value,\n          \"issuerId\": document.getElementById(\"issuer\").value,\n          \"docType\": document.getElementById(\"docType\").value,\n          \"docNumber\": document.getElementById(\"docNumber\").value\n        })\n      })\n        .then((res) => {\n          console.log(res)\n          if (res.ok) {\n            return res.json()\n          }\n          else {\n            M.toast({ html: \"Error inesperado\", classes: \"#c62828 red darken-3\" });\n            window.Mercadopago.clearSession()\n          }\n        })\n        .then((data) => {\n          if (data && (data.status_detail === \"accredited\" || data.status_detail === \"pending_contingency\" || data.status_detail === \"pending_review_manual\")) {\n            console.log(data.comunicacion_sugerida)\n            console.log(\"realizandoPAGO\")\n            M.toast({ html: data.comunicacion_sugerida, classes: \"#388e3c green darken-2\" });\n            actualizarBaseDeDatos()\n            vacioCarrito()\n          }\n          else {\n            M.toast({ html: data.comunicacion_sugerida, classes: \"#c62828 red darken-3\" });\n          }\n          history.push(\"/\");\n          window.Mercadopago.clearSession()\n        })\n        .catch((err) => {\n          console.log(err);\n          window.Mercadopago.clearSession()\n        });\n    } else {\n      M.toast({ html: \"Llenar todos los campos\", classes: \"#c62828 red darken-3\" });\n    }\n  };\n\n  const actualizarBaseDeDatos = () => {\n    fetch(\"https://exposicion-virtual.herokuapp.com/productSales\", {\n      method: \"PUT\",\n      headers: {\n        \"Content-type\": \"application/json\",\n        \"Authorization\": localStorage.getItem(\"tokenValido\")\n      },\n      body: JSON.stringify({\n        \"sales\": listaProductosEnPares()\n      })\n    })\n      .then((res) => {\n        console.log(res)\n      })\n      .catch((error) => {\n        console.log(error);\n      })\n  };\n\n  const listaProductosEnPares = () => {\n    let arrayResultado = []\n    context.cart.forEach(\n      product => {\n        console.log(\"Pase por (\" + product.id + \", \" + product.quantity + \")\")\n        arrayResultado.push({ \"idProducto\": product.id, \"cantidadVendida\": product.quantity })\n      }\n    )\n    console.log(arrayResultado)\n    return arrayResultado\n  }\n\n  const vacioCarrito = () => {\n    context.cart.forEach(\n      product => {\n        context.deleteProductFromCart(product.id)\n      }\n    )\n  }\n\n  const selectDocTypes = () => {\n    if (docTypes.length === 0) {\n      fetch(\"https://api.mercadopago.com/v1/identification_types?public_key=TEST-147fd98d-a235-429b-aa09-a5b157a1fe61\", {\n        headers: {\n          \"Content-type\": \"application/json\",\n        }\n      }).then((res) => {\n        if (res.ok) {\n          return res.json()\n        }\n      }).then((response) => {\n        setDocTypes(response)\n      })\n    }\n    return (<select id=\"docType\" name=\"docType\" data-checkout=\"docType\" class=\"form-control select-visible\">\n      {docTypes.map((opt => {\n        return (<option value={opt.id}>{opt.name}</option>)\n      }))}\n    </select>)\n  }\n\n  return (\n    <div>\n      {checkoutShoppingCart()}\n      <section class=\"payment-form dark\">\n        <div class=\"container_payment\">\n          <div class=\"block-heading\">\n            <h2>Pago con tarjeta</h2>\n          </div>\n          <div class=\"form-payment\">\n            <div class=\"products\">\n              <h2 class=\"title\">Resumen</h2>\n              <div class=\"item\">\n                <span class=\"price\" id=\"summary-price\" value={'$ ' + unitPrice}></span>\n                {context.cart.map(product => {\n                  return (\n                    <div className=\"row\">\n                      <div className=\"col s6\">\n                        <p class=\"item-name\">{product.itemName} <span id=\"summary-quantity\" value={quantity}>x {product.quantity}</span></p>\n                      </div>\n                      <div className=\"col s6\">\n                        <p class=\"item-name item-total-price\">$ {product.itemPrice * product.quantity}</p>\n                      </div>\n                    </div>\n                  )\n                })}\n                <div className=\"row\">\n                  <div className=\"col s6\">\n                    <p class=\"item-name\">{sendMethodNameTopLevel} <span id=\"summary-quantity\"></span></p>\n                  </div>\n                  <div className=\"col s6\">\n                    <p class=\"item-name item-total-price\">$ {sendMethodCostTopLevel}</p>\n                  </div>\n                </div>\n              </div>\n              <div class=\"total\">Total<span class=\"price\" id=\"summary-total\" >$ {precioTotal(context.cart) + sendMethodCostTopLevel}</span></div>\n            </div>\n            <div class=\"payment-details\">\n              <form action=\"#\" id=\"paymentForm\">\n                <h3 class=\"title\">Datos del comprador</h3>\n                <div class=\"row\">\n                  <div class=\"form-group col-sm-5\">\n                    <label for=\"email\">E-Mail</label>\n                    <input id=\"email\" name=\"email\" type=\"text\" class=\"form-control\" onChange={(e) => setEmail(e.target.value)} />\n                  </div>\n                </div>\n                <div class=\"row\">\n                  <div class=\"form-group col-sm-5\">\n                    <label for=\"docType\">Tipo de documento</label>\n                    {selectDocTypes()}\n                  </div>\n                  <div class=\"form-group col-sm-7\">\n                    <label for=\"docNumber\">Numero de documento</label>\n                    <input id=\"docNumber\" name=\"docNumber\" data-checkout=\"docNumber\" type=\"text\" class=\"form-control\" />\n                  </div>\n                </div>\n                <br />\n                <h3 class=\"title\">Datos de la tarjeta</h3>\n                <div class=\"row\">\n                  <div class=\"form-group col-sm-8\">\n                    <label for=\"cardholderName\">Titular de la tarjeta</label>\n                    <input id=\"cardholderName\" data-checkout=\"cardholderName\" type=\"text\" class=\"form-control\" />\n                  </div>\n                  <div class=\"col s12\">\n                    <label for=\"\">Fecha de vencimiento</label>\n                    <div class=\"input-group expiration-date\">\n                      <input type=\"text\" class=\"form-control\" placeholder=\"MM\" id=\"cardExpirationMonth\" data-checkout=\"cardExpirationMonth\"\n                        onselectstart=\"return false\" onpaste=\"return false\" onCopy=\"return false\" onCut=\"return false\" onDrag=\"return false\" onDrop=\"return false\" autocomplete='off' />\n                      <span class=\"date-separator\">/</span>\n                      <input type=\"text\" class=\"form-control\" placeholder=\"YY\" id=\"cardExpirationYear\" data-checkout=\"cardExpirationYear\"\n                        onselectstart=\"return false\" onpaste=\"return false\" onCopy=\"return false\" onCut=\"return false\" onDrag=\"return false\" onDrop=\"return false\" autocomplete='off' />\n                    </div>\n                  </div>\n                  <div class=\"form-group col-sm-8\">\n                    <label for=\"cardNumber\">Nmero de tarjeta</label>\n                    <input type=\"text\" class=\"form-control input-background\" id=\"cardNumber\" data-checkout=\"cardNumber\"\n                      onselectstart=\"return false\" onpaste=\"return false\" onCopy=\"return false\" onCut=\"return false\" onDrag=\"return false\" onDrop=\"return false\" style={paymentmethodThumbnailStyle} autocomplete='off' onChange={guessPaymentMethod} />\n                  </div>\n                  <div class=\"form-group col-sm-4\">\n                    <label for=\"securityCode\">Cdigo de seguridad</label>\n                    <input id=\"securityCode\" data-checkout=\"securityCode\" type=\"text\" class=\"form-control\"\n                      onselectstart=\"return false\" onpaste=\"return false\" onCopy=\"return false\" onCut=\"return false\" onDrag=\"return false\" onDrop=\"return false\" autocomplete='off' />\n                  </div>\n                  <div id=\"issuerInput\" class=\"form-group col-sm-12 hidden\">\n                    <label for=\"issuer\">Entidad emisora</label>\n                    <select id=\"issuer\" name=\"issuer\" data-checkout=\"issuer\" class=\"form-control select-visible\" onChange={updateInstallmentsForIssuer}></select>\n                  </div>\n                  <div class=\"form-group col-sm-12\">\n                    <label for=\"installments\">Cuotas</label>\n                    <select type=\"text\" id=\"installments\" name=\"installments\" class=\"form-control select-visible\"></select>\n                  </div>\n                  <div class=\"form-group col-sm-12\">\n                    <input type=\"hidden\" name=\"transactionAmount\" id=\"amount\" value={amount} />\n                    <input type=\"hidden\" name=\"paymentMethodId\" id=\"paymentMethodId\" value={paymentmethodId} />\n                    <input type=\"hidden\" name=\"description\" id=\"description\" value={description} />\n                    <br />\n                    <div className=\"row\">\n                      <div className=\"col s12\">\n                        <a onClick={getCardToken} className=\"waves-effect waves-light red lighten-2 btn-large\" id=\"butonSubmit\">Pagar</a>\n                      </div>\n                    </div>\n                    <br />\n\n                    <a id=\"go-back\" href=\"/shoppingcart\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 10 10\" class=\"chevron-left\">\n                        <path fill=\"#009EE3\" fill-rule=\"nonzero\" id=\"chevron_left\" d=\"M7.05 1.4L6.2.552 1.756 4.997l4.449 4.448.849-.848-3.6-3.6z\"></path>\n                      </svg>\n                         Volver al carrito\n                       </a>\n                  </div>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n\nexport default TestForm;"]},"metadata":{},"sourceType":"module"}